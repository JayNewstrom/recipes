This website is deployed to AWS.

Using a few AWS tools:
- S3
- CloudFront
- Lambda@Edge
- Iam
- Certificate Manager

This directory includes a Terraform script that creates all the infrastructure needed to run the site, as well as do automatic deployments when changes are pushed.

## Terraform
This assumes you are already authenticated with an AWS administrator role setup on the command line.

First run - `terraform init`

Run with - `terraform apply -var-file recipes.tfvars`


Example `recipes.tfvars`:
```
domain_name = "recipes.newstrom.life"

# Go to dash.cloudflare.com, click on the domain you want to use, scroll down, you'll see Zone ID on the right side. 
cloudflare_zone = "a000a000a000a000aaa00aaa0"
cloudflare_api_token = "aaa0aaa0"

# Can also be used with wildcards like "repo:JayNewstrom/recipes:*". 
github_oidc_repository_slug = "repo:JayNewstrom/recipes:ref:refs/heads/master"
```

## GitHub Actions Secrets
Deploys happen automatically when pushed to `master`.

You'll need to set up a few secrets in the GitHub actions secrets menu: 
- Go to the menu, such as https://github.com/JayNewstrom/recipes/settings/secrets/actions
- Add the following secrets:
  - `AWS_BUCKET_NAME`: This will be the domain name you specified in your `tfvars` file
  - `AWS_CLOUDFRONT_DISTRIBUTION`: This has a unique name generated by AWS, look this up in the AWS console
  - `AWS_ROLE`: This is the auto provisioned IAM role to allow OIDC authentication with AWS from GitHub actions, it should have a value of `arn:aws:iam::YOUR_AWS_ACCOUNT_NUMBER_HERE:role/RecipesGithubActionsRole`
